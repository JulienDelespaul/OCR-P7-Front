{"ast":null,"code":"var _jsxFileName = \"/home/julien/Dropbox/Formation OpenClassroom/Projet 7/code/FRONTEND/src/components/PostsPageComponents/PostsPageEditPost.jsx\",\n    _s = $RefreshSig$();\n\nimport \"../Button/button.css\";\nimport { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport axios from \"../../Api/axios\";\nimport useAuth from \"../../hooks/useAuth\";\nimport usePostsRefresh from \"../../hooks/usePostsRefresh\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst PostsPageEditPost = _ref => {\n  _s();\n\n  let {\n    post,\n    setShowModal\n  } = _ref;\n  const [image, setImage] = useState({\n    img: null,\n    imgUrl: null\n  });\n  const [freshPost, setFreshPost] = useState(post);\n  const {\n    auth\n  } = useAuth();\n  const {\n    refresh,\n    setRefresh\n  } = usePostsRefresh();\n  const id = post._id;\n  useEffect(() => {\n    let isMounted = true;\n\n    const getPost = async () => {\n      try {\n        const response = await axios.get(`/post/${id}`, {\n          headers: {\n            Authorization: `Bearer ${auth.token}`\n          }\n        });\n        const freshPostData = response.data;\n        isMounted && setFreshPost(freshPostData);\n        console.log(\"fresh post data\", freshPostData);\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    getPost();\n    return () => {\n      isMounted = false;\n    };\n  }, [id, auth.token]);\n\n  const HandleInput = async data => {\n    const formData = new FormData();\n    formData.append(\"content\", data.content);\n    formData.append(\"image\", image.img);\n\n    try {\n      const response = await axios.put(`/post/${id}`, formData, {\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n          Authorization: `Bearer ${auth.token}`\n        }\n      });\n      console.log(response); // toggle refresh to trigger useEffect in Posts.jsx\n\n      setRefresh(!refresh);\n      reset();\n      setImage({\n        img: null,\n        imgUrl: null\n      });\n      setShowModal(false);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const HandleImageSelection = e => {\n    e.preventDefault(); // display image from input\n\n    if (e.target.files && e.target.files[0]) {\n      let img = e.target.files[0];\n      let imgUrl = URL.createObjectURL(img);\n      setImage({\n        img,\n        imgUrl\n      });\n      console.log(image);\n    }\n\n    console.log(e.target.files[0]);\n  };\n\n  const {\n    register,\n    handleSubmit,\n    reset\n  } = useForm();\n  return /*#__PURE__*/_jsxDEV(\"form\", {\n    onSubmit: handleSubmit(HandleInput),\n    className: \"h-min  w-full text-lg flex flex-col justify-between object-top \",\n    children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n      className: \"p-4 h-32 flex text-wrap bg-secondary text-tertiary  border-1 border-black resize-none\",\n      placeholder: \"...\",\n      type: \"text\",\n      name: \"content\" // value={post.content}\n      ,\n      ...register(\"content\"),\n      children: freshPost.content\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: image.img && /*#__PURE__*/_jsxDEV(\"img\", {\n        src: image.imgUrl,\n        alt: \"preview\",\n        className: \"h-80 mt-4 mx-auto rounded-2xl object-cover\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 23\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: !image.img && /*#__PURE__*/_jsxDEV(\"img\", {\n        src: freshPost.imageUrl,\n        alt: \"preview\",\n        className: \"h-80 mt-4 mx-auto rounded-2xl object-cover\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 24\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-end\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"brutal-btn m-4 cursor-pointer\",\n        children: [post !== null && post !== void 0 && post.imageUrl ? /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Changer d'image\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 24\n        }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"Ajouter une image\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 55\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          className: \"hidden\",\n          name: \"image\",\n          ...register(\"image\"),\n          onChange: HandleImageSelection\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 6\n        }, this), \" \"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"brutal-btn m-4\",\n        children: \"Poster\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 3\n  }, this);\n};\n\n_s(PostsPageEditPost, \"b2zUNBvKTk/zIKvbMviHIoNI4b8=\", false, function () {\n  return [useAuth, usePostsRefresh, useForm];\n});\n\n_c = PostsPageEditPost;\nexport default PostsPageEditPost;\n\nvar _c;\n\n$RefreshReg$(_c, \"PostsPageEditPost\");","map":{"version":3,"names":["useState","useEffect","useForm","axios","useAuth","usePostsRefresh","PostsPageEditPost","post","setShowModal","image","setImage","img","imgUrl","freshPost","setFreshPost","auth","refresh","setRefresh","id","_id","isMounted","getPost","response","get","headers","Authorization","token","freshPostData","data","console","log","error","HandleInput","formData","FormData","append","content","put","reset","HandleImageSelection","e","preventDefault","target","files","URL","createObjectURL","register","handleSubmit","imageUrl"],"sources":["/home/julien/Dropbox/Formation OpenClassroom/Projet 7/code/FRONTEND/src/components/PostsPageComponents/PostsPageEditPost.jsx"],"sourcesContent":["import \"../Button/button.css\";\nimport { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport axios from \"../../Api/axios\";\nimport useAuth from \"../../hooks/useAuth\";\nimport usePostsRefresh from \"../../hooks/usePostsRefresh\";\n\nconst PostsPageEditPost = ({ post, setShowModal }) => {\n\tconst [image, setImage] = useState({ img: null, imgUrl: null });\n\tconst [freshPost, setFreshPost] = useState(post);\n\tconst { auth } = useAuth();\n\tconst { refresh, setRefresh } = usePostsRefresh();\n\tconst id = post._id;\n\n\tuseEffect(() => {\n\t\tlet isMounted = true;\n\n\t\tconst getPost = async () => {\n\t\t\ttry {\n\t\t\t\tconst response = await axios.get(`/post/${id}`, {\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tAuthorization: `Bearer ${auth.token}`,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tconst freshPostData = response.data;\n\t\t\t\tisMounted && setFreshPost(freshPostData);\n\t\t\t\tconsole.log(\"fresh post data\", freshPostData);\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log(error);\n\t\t\t}\n\t\t};\n\t\tgetPost();\n\n\t\treturn () => {\n\t\t\tisMounted = false;\n\t\t};\n\t}, [id, auth.token]);\n\n\tconst HandleInput = async (data) => {\n\t\tconst formData = new FormData();\n\t\tformData.append(\"content\", data.content);\n\t\tformData.append(\"image\", image.img);\n\t\ttry {\n\t\t\tconst response = await axios.put(`/post/${id}`, formData, {\n\t\t\t\theaders: {\n\t\t\t\t\t\"Content-Type\": \"multipart/form-data\",\n\t\t\t\t\tAuthorization: `Bearer ${auth.token}`,\n\t\t\t\t},\n\t\t\t});\n\t\t\tconsole.log(response);\n\t\t\t// toggle refresh to trigger useEffect in Posts.jsx\n\t\t\tsetRefresh(!refresh);\n\t\t\treset();\n\t\t\tsetImage({ img: null, imgUrl: null });\n\t\t\tsetShowModal(false);\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t}\n\t};\n\n\tconst HandleImageSelection = (e) => {\n\t\te.preventDefault();\n\t\t// display image from input\n\t\tif (e.target.files && e.target.files[0]) {\n\t\t\tlet img = e.target.files[0];\n\t\t\tlet imgUrl = URL.createObjectURL(img);\n\t\t\tsetImage({ img, imgUrl });\n\t\t\tconsole.log(image);\n\t\t}\n\t\tconsole.log(e.target.files[0]);\n\t};\n\n\tconst { register, handleSubmit, reset } = useForm();\n\n\treturn (\n\t\t<form onSubmit={handleSubmit(HandleInput)} className=\"h-min  w-full text-lg flex flex-col justify-between object-top \">\n\t\t\t<textarea\n\t\t\t\tclassName=\"p-4 h-32 flex text-wrap bg-secondary text-tertiary  border-1 border-black resize-none\"\n\t\t\t\tplaceholder=\"...\"\n\t\t\t\ttype=\"text\"\n\t\t\t\tname=\"content\"\n\t\t\t\t// value={post.content}\n\t\t\t\t{...register(\"content\")}\n\t\t\t>\n\t\t\t\t{freshPost.content}\n\t\t\t</textarea>\n\t\t\t<div>{image.img && <img src={image.imgUrl} alt=\"preview\" className=\"h-80 mt-4 mx-auto rounded-2xl object-cover\" />}</div>\n\t\t\t<div>{!image.img && <img src={freshPost.imageUrl} alt=\"preview\" className=\"h-80 mt-4 mx-auto rounded-2xl object-cover\" />}</div>\n\t\t\t<div className=\"flex justify-end\">\n\t\t\t\t<label className=\"brutal-btn m-4 cursor-pointer\">\n\t\t\t\t\t{post?.imageUrl ? <span>Changer d'image</span> : <span>Ajouter une image</span>}\n\t\t\t\t\t<input type=\"file\" className=\"hidden\" name=\"image\" {...register(\"image\")} onChange={HandleImageSelection} />{\" \"}\n\t\t\t\t</label>\n\t\t\t\t<button className=\"brutal-btn m-4\">Poster</button>\n\t\t\t</div>\n\t\t</form>\n\t);\n};\n\nexport default PostsPageEditPost;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}